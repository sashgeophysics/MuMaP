program temp
  implicit none
  INTEGER::dim
  CHARACTER(len=72)::fname,fname2
  character(len=24)::colnum,fmt
  INTEGER::ncols,NGRID ! The number ofcolumns in the input file

  REAL,DIMENSION(:,:),POINTER::DATA
  REAL,DIMENSION(:,:),POINTER::x
  REAL,DIMENSION(3)::prem_value

  INTEGER::ii
  fname='../input/temp'
  fname2='../input/hmtdata.csv'
  NGRID=line_numbers(fname,10000)
  ncols=14
  WRITE(colnum,'(i3)'),ncols
  print*,ncols
  fmt="("//trim(colnum)//"(1x,es10.3))"
  ALLOCATE(DATA(NGRID,ncols),x(NGRID,3))
  OPEN(10,file=fname,status='unknown',form='formatted')
  OPEN(20,file=fname2,status='unknown',form='formatted')
  print*,'hello',fmt
  DO ii=1,NGRID
     READ(10,fmt),DATA(ii,:)
     write(20,fmt),DATA(ii,:)
  END DO
  CLOSE(10)
  close(20)
contains
  !> This is a utility function to count the number of lines in a file
  !On input, filename is the name of the file and lmax is a guess
  ! about how many lines there are. If you are not sure, provide a
  ! large number, say, 10000. !<
  FUNCTION line_numbers(fname,lmax)
    IMPLICIT NONE
    CHARACTER(len=*),INTENT(in)::fname
    INTEGER,INTENT(in)::lmax
    INTEGER::line_numbers,ii,lineno,ios
    REAL::junk
    lineno=0
    OPEN(10,file=fname,form='formatted')
    DO ii=1,lmax
       READ(10,*,IOSTAT=ios), junk
       IF(ios/=0) EXIT
       lineno=lineno+1
    END DO
    CLOSE(10)
    !PRINT*,'linenumber:',lineno
    line_numbers=lineno
  END FUNCTION line_numbers
end program temp
